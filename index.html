<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Printer | Smart Cloud Print</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        magic: { 900: '#0f172a', 800: '#1e293b', 500: '#3b82f6', 400: '#60a5fa' },
                        kyocera: { black: '#1a1a1a', red: '#c41230' }
                    }
                }
            }
        }
        // PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }

        /* Loader Animation */
        .loader { border: 4px solid #1e293b; border-top: 4px solid #3b82f6; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Visual Overlays for Finishing */
        .staple-tl { position: absolute; top: 10px; left: 10px; width: 40px; height: 8px; background: linear-gradient(90deg, #ccc, #fff, #ccc); transform: rotate(-45deg); box-shadow: 1px 1px 3px rgba(0,0,0,0.5); z-index: 50; }
        .staple-tr { position: absolute; top: 10px; right: 10px; width: 40px; height: 8px; background: linear-gradient(90deg, #ccc, #fff, #ccc); transform: rotate(45deg); box-shadow: 1px 1px 3px rgba(0,0,0,0.5); z-index: 50; }
        .punch-2 { position: absolute; top: 0; left: 10px; height: 100%; display: flex; flex-direction: column; justify-content: space-around; z-index: 50; }
        .hole { width: 12px; height: 12px; background: #0f172a; border-radius: 50%; border: 1px solid #475569; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.8); }
    </style>
</head>
<body class="h-screen flex flex-col md:flex-row overflow-hidden">

    <div class="w-full md:w-7/12 lg:w-2/3 bg-slate-900 relative flex flex-col items-center justify-center p-6 border-b md:border-b-0 md:border-r border-slate-700">
        
        <div class="md:hidden w-full flex justify-between items-center mb-4">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-print text-magic-400 text-xl"></i>
                <span class="font-bold text-lg tracking-tight">MAGIC<span class="text-magic-400">PRINTER</span></span>
            </div>
        </div>

        <div id="drop-zone" class="w-full h-full max-w-2xl bg-slate-800 rounded-xl border-2 border-dashed border-slate-600 flex flex-col items-center justify-center cursor-pointer transition-all hover:border-magic-400 hover:bg-slate-700/50 relative overflow-hidden group">
            
            <div id="idle-state" class="text-center p-8 transition-opacity duration-300">
                <div class="w-20 h-20 bg-slate-700 rounded-full flex items-center justify-center mx-auto mb-6 group-hover:scale-110 transition-transform">
                    <i class="fa-solid fa-cloud-arrow-up text-3xl text-magic-400"></i>
                </div>
                <h2 class="text-2xl font-bold mb-2">Upload File</h2>
                <p class="text-slate-400 text-sm mb-6">PDF, JPG, PNG (Max 50MB)</p>
                <button class="bg-magic-500 hover:bg-magic-400 text-white px-6 py-2 rounded-full font-medium transition-colors">Browse Files</button>
            </div>

            <div id="loading-state" class="hidden absolute inset-0 bg-slate-900/90 flex flex-col items-center justify-center z-20">
                <div class="loader mb-4"></div>
                <p class="text-magic-400 animate-pulse">Processing Document...</p>
            </div>

            <div id="preview-container" class="hidden w-full h-full relative p-8 flex items-center justify-center bg-slate-800">
                <div class="relative shadow-2xl transition-transform duration-300" id="paper-wrapper">
                    <canvas id="the-canvas" class="block max-w-full max-h-full"></canvas>
                    
                    <div id="overlay-staple-tl" class="staple-tl hidden"></div>
                    <div id="overlay-staple-tr" class="staple-tr hidden"></div>
                    <div id="overlay-punch" class="punch-2 hidden">
                        <div class="hole"></div><div class="hole"></div><div class="hole"></div>
                    </div>
                </div>
            </div>

            <input type="file" id="file-input" class="hidden" accept=".pdf,.jpg,.png,.jpeg">
        </div>
        
        <div id="file-info" class="hidden absolute bottom-6 bg-slate-800 px-4 py-2 rounded-lg border border-slate-600 shadow-lg flex items-center gap-3">
            <i class="fa-solid fa-file-pdf text-red-500"></i>
            <span id="filename-display" class="text-sm font-mono text-slate-300">document.pdf</span>
            <button onclick="resetApp()" class="text-slate-500 hover:text-white ml-2"><i class="fa-solid fa-xmark"></i></button>
        </div>
    </div>

    <div class="w-full md:w-5/12 lg:w-1/3 bg-slate-950 flex flex-col h-full overflow-y-auto">
        
        <div class="hidden md:flex items-center gap-3 p-6 border-b border-slate-800">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20">
                <i class="fa-solid fa-wand-magic-sparkles text-white text-lg"></i>
            </div>
            <div>
                <h1 class="font-bold text-xl tracking-tight">MAGIC<span class="text-blue-500">PRINTER</span></h1>
                <p class="text-xs text-slate-500 uppercase tracking-wider">Business Print Portal</p>
            </div>
        </div>

        <div class="p-6 space-y-8 flex-1">
            
            <div class="space-y-4 opacity-50 pointer-events-none transition-opacity" id="step-specs">
                <div class="flex items-center gap-2 text-magic-400 font-semibold text-sm uppercase tracking-wider">
                    <i class="fa-solid fa-sliders"></i> Print Specifications
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button class="opt-btn active ring-2 ring-magic-500 bg-slate-800 p-3 rounded-lg border border-slate-700 flex flex-col items-center gap-2 hover:bg-slate-700 transition-all" onclick="setOption('color', false, this)">
                        <i class="fa-solid fa-droplet-slash text-slate-400"></i>
                        <span class="text-sm font-medium">Black & White</span>
                    </button>
                    <button class="opt-btn bg-slate-800 p-3 rounded-lg border border-slate-700 flex flex-col items-center gap-2 hover:bg-slate-700 transition-all" onclick="setOption('color', true, this)">
                        <i class="fa-solid fa-palette text-pink-500"></i>
                        <span class="text-sm font-medium">Full Color</span>
                    </button>
                </div>

                <div class="space-y-3">
                    <label class="text-xs text-slate-500 uppercase font-semibold">Finishing</label>
                    <select id="finishing-select" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:ring-2 focus:ring-magic-500 outline-none" onchange="updateFinishing(this.value)">
                        <option value="none">No Finishing</option>
                        <option value="staple-tl">Staple: Top-Left (Corner)</option>
                        <option value="staple-tr">Staple: Top-Right</option>
                        <option value="punch-2">Hole Punch: 2-Hole (Left)</option>
                        <option value="punch-3">Hole Punch: 3-Hole (Left)</option>
                        <option value="booklet">Booklet (Fold + Center Staple)</option>
                    </select>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-xs text-slate-500 uppercase font-semibold">Copies</label>
                        <div class="flex items-center mt-1">
                            <button onclick="adjustCopies(-1)" class="w-8 h-10 bg-slate-800 rounded-l-lg border border-slate-700 hover:bg-slate-700">-</button>
                            <input type="number" id="copies-input" value="1" class="w-full h-10 bg-slate-800 border-y border-slate-700 text-center text-sm focus:outline-none" readonly>
                            <button onclick="adjustCopies(1)" class="w-8 h-10 bg-slate-800 rounded-r-lg border border-slate-700 hover:bg-slate-700">+</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-slate-500 uppercase font-semibold">Paper</label>
                        <select class="w-full h-10 mt-1 bg-slate-800 border border-slate-700 rounded-lg px-2 text-sm">
                            <option>Standard (24lb)</option>
                            <option>Cardstock (80lb)</option>
                            <option>Glossy</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="space-y-4 opacity-50 pointer-events-none transition-opacity" id="step-info">
                <div class="flex items-center gap-2 text-magic-400 font-semibold text-sm uppercase tracking-wider">
                    <i class="fa-solid fa-user"></i> Customer Details
                </div>
                <input type="text" id="customer-name" placeholder="Full Name" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:ring-2 focus:ring-magic-500 outline-none">
                <input type="email" id="customer-email" placeholder="Email Address" class="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-sm focus:ring-2 focus:ring-magic-500 outline-none">
            </div>

            <div class="pt-4 border-t border-slate-800 opacity-50 pointer-events-none" id="step-submit">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <p class="text-xs text-slate-500">Estimated Total</p>
                        <h3 class="text-2xl font-bold text-white" id="price-display">$0.00</h3>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-slate-500" id="job-summary">0 Pages • B&W</p>
                    </div>
                </div>
                <button onclick="submitOrder()" class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-900/50 transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
                    <span>Send Order</span>
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
                <p class="text-center text-xs text-slate-600 mt-4"><i class="fa-solid fa-lock"></i> Secure Payment by Stripe (Demo)</p>
            </div>

        </div>
    </div>

    <script>
        // State
        let state = {
            file: null,
            pageCount: 0,
            color: false,
            copies: 1,
            finishing: 'none',
            pricePerBW: 0.10,
            pricePerColor: 0.45
        };

        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');

        // Drag & Drop Handlers
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('border-magic-400'); });
        dropZone.addEventListener('dragleave', () => dropZone.classList.remove('border-magic-400'));
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('border-magic-400');
            if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
        });
        fileInput.addEventListener('change', (e) => { if (e.target.files.length) handleFile(e.target.files[0]); });

        async function handleFile(file) {
            if (file.type !== 'application/pdf') {
                alert('For this demo, please upload a PDF.');
                return;
            }
            
            state.file = file;
            document.getElementById('filename-display').innerText = file.name;
            document.getElementById('idle-state').classList.add('hidden');
            document.getElementById('loading-state').classList.remove('hidden');

            // Simulate "Reading"
            const fileReader = new FileReader();
            fileReader.onload = async function() {
                const typedarray = new Uint8Array(this.result);
                
                // Render PDF using PDF.js
                const pdf = await pdfjsLib.getDocument(typedarray).promise;
                state.pageCount = pdf.numPages;
                
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 1.5 });
                const canvas = document.getElementById('the-canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;

                await page.render({ canvasContext: context, viewport: viewport }).promise;

                // UI Transition
                document.getElementById('loading-state').classList.add('hidden');
                document.getElementById('preview-container').classList.remove('hidden');
                document.getElementById('file-info').classList.remove('hidden');
                
                // Unlock Steps
                document.getElementById('step-specs').classList.remove('opacity-50', 'pointer-events-none');
                document.getElementById('step-info').classList.remove('opacity-50', 'pointer-events-none');
                document.getElementById('step-submit').classList.remove('opacity-50', 'pointer-events-none');
                
                updatePrice();
            };
            fileReader.readAsArrayBuffer(file);
        }

        // --- Logic Functions ---

        function setOption(key, value, btn) {
            state[key] = value;
            // Visual toggle logic for buttons would go here (removing/adding classes)
            // Ideally use React for this, but Vanilla JS works for simple apps
            const siblings = btn.parentElement.children;
            for (let sib of siblings) sib.classList.remove('ring-2', 'ring-magic-500');
            btn.classList.add('ring-2', 'ring-magic-500');
            updatePrice();
        }

        function updateFinishing(val) {
            state.finishing = val;
            
            // Manage Visual Overlays
            document.getElementById('overlay-staple-tl').classList.add('hidden');
            document.getElementById('overlay-staple-tr').classList.add('hidden');
            document.getElementById('overlay-punch').classList.add('hidden');
            
            if (val === 'staple-tl') document.getElementById('overlay-staple-tl').classList.remove('hidden');
            if (val === 'staple-tr') document.getElementById('overlay-staple-tr').classList.remove('hidden');
            if (val.includes('punch')) document.getElementById('overlay-punch').classList.remove('hidden');
            
            updatePrice();
        }

        function adjustCopies(delta) {
            const newVal = state.copies + delta;
            if (newVal >= 1) {
                state.copies = newVal;
                document.getElementById('copies-input').value = newVal;
                updatePrice();
            }
        }

        function updatePrice() {
            const base = state.color ? state.pricePerColor : state.pricePerBW;
            const subtotal = base * state.pageCount * state.copies;
            
            // Finishing Costs
            let finishingCost = 0;
            if (state.finishing.includes('staple')) finishingCost = 0.02 * state.copies;
            if (state.finishing === 'booklet') finishingCost = 0.15 * state.copies;
            
            const total = subtotal + finishingCost;
            
            document.getElementById('price-display').innerText = '$' + total.toFixed(2);
            document.getElementById('job-summary').innerText = `${state.pageCount} Pages • ${state.copies} Copies • ${state.color ? 'Color' : 'B&W'}`;
        }

        function submitOrder() {
            const name = document.getElementById('customer-name').value;
            const email = document.getElementById('customer-email').value;
            
            if (!name || !email) {
                alert('Please fill in customer details.');
                return;
            }

            // In a real app, this sends data to a Backend (Stripe/Database)
            // For now, we simulate the "Agent" experience
            
            const jobSummary = `
MAGIC PRINTER ORDER
-------------------
Customer: ${name} (${email})
File: ${state.file.name}
Pages: ${state.pageCount}
Copies: ${state.copies}
Color: ${state.color ? 'Yes' : 'No'}
Finishing: ${state.finishing.toUpperCase()}
-------------------
TOTAL ESTIMATE: ${document.getElementById('price-display').innerText}
            `;
            
            alert("SUCCESS! \n\nIn a live version, this would:\n1. Charge the user via Stripe\n2. Email you (Ali) this receipt + the file\n\n" + jobSummary);
        }

        function resetApp() {
            location.reload();
        }
    </script>
</body>
</html>
