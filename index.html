<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Printer | Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { 950: '#0b0f19', 900: '#111827', 800: '#1f2937', 600: '#2563eb', 500: '#3b82f6', 400: '#60a5fa' },
                        accent: { 500: '#ef4444' } // Red for PDFs
                    },
                    screens: {
                        'xs': '375px',
                        'touch': {'raw': '(hover: none)'}
                    }
                }
            }
        }
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0b0f19; color: white; -webkit-tap-highlight-color: transparent; }
        
        /* Mobile-First Layout Tweaks */
        .paper-shadow { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Finishing Marks */
        .staple-mark { position: absolute; width: 24px; height: 5px; background: linear-gradient(90deg, #94a3b8, #e2e8f0, #94a3b8); border-radius: 2px; box-shadow: 1px 1px 2px rgba(0,0,0,0.5); z-index: 20; }
        .punch-hole { width: 12px; height: 12px; background: #111827; border-radius: 50%; box-shadow: inset 1px 1px 3px rgba(0,0,0,0.8); z-index: 20; }
        .fold-line { position: absolute; border-left: 1px dashed rgba(0,0,0,0.3); height: 100%; z-index: 10; }
    </style>
</head>
<body class="h-[100dvh] flex flex-col overflow-hidden text-gray-100">

    <header class="h-16 bg-brand-900 border-b border-gray-800 flex items-center justify-between px-4 z-40 shrink-0">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center shadow-lg">
                <i class="fa-solid fa-print text-white text-sm"></i>
            </div>
            <h1 class="font-bold text-lg tracking-tight">MAGIC<span class="text-brand-400">PRINTER</span></h1>
        </div>
        
        <div class="flex items-center gap-3">
            <div id="user-badge" class="text-xs text-gray-400 hidden sm:block">Guest</div>
            <button onclick="toggleCart()" class="relative p-2 bg-brand-800 rounded-full w-10 h-10 flex items-center justify-center">
                <i class="fa-solid fa-basket-shopping text-gray-300"></i>
                <span id="cart-badge" class="absolute -top-1 -right-1 bg-brand-500 text-[10px] w-5 h-5 rounded-full flex items-center justify-center border border-brand-900 hidden">0</span>
            </button>
        </div>
    </header>

    <div id="login-modal" class="fixed inset-0 z-[60] bg-brand-950 flex flex-col items-center justify-center p-6 transition-opacity duration-300">
        <div class="w-full max-w-sm bg-brand-900 border border-gray-800 rounded-2xl p-6 shadow-2xl">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-brand-600 rounded-2xl mx-auto flex items-center justify-center mb-4 text-3xl shadow-lg shadow-blue-900/40">
                    <i class="fa-solid fa-layer-group"></i>
                </div>
                <h2 class="text-2xl font-bold text-white">Welcome</h2>
                <p class="text-gray-400 text-sm mt-1">Enter your details to start printing</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="text-xs uppercase font-bold text-gray-500 ml-1">Company / Name</label>
                    <input type="text" id="login-name" class="w-full bg-brand-950 border border-gray-700 rounded-xl p-3.5 text-white focus:border-brand-500 focus:outline-none transition-colors" placeholder="e.g. Acme Corp">
                </div>
                <div>
                    <label class="text-xs uppercase font-bold text-gray-500 ml-1">Email</label>
                    <input type="email" id="login-email" class="w-full bg-brand-950 border border-gray-700 rounded-xl p-3.5 text-white focus:border-brand-500 focus:outline-none transition-colors" placeholder="user@example.com">
                </div>
                <button onclick="login()" class="w-full bg-brand-600 hover:bg-brand-500 active:bg-brand-700 text-white font-bold py-4 rounded-xl transition-all shadow-lg mt-2 text-lg">
                    Start Printing
                </button>
            </div>
        </div>
    </div>

    <main class="flex-1 overflow-y-auto overflow-x-hidden bg-brand-950 relative scroll-smooth pb-20 lg:pb-0" id="main-scroll">
        
        <div id="view-new" class="flex flex-col lg:flex-row min-h-full">
            
            <div class="w-full lg:flex-1 bg-[#0f1218] flex flex-col items-center justify-start pt-6 pb-6 relative min-h-[350px] lg:h-auto lg:sticky lg:top-0">
                
                <div id="upload-state" class="w-full px-6 flex flex-col items-center mt-4">
                    <div onclick="document.getElementById('file-input').click()" class="w-full max-w-md aspect-[4/3] border-2 border-dashed border-gray-700 rounded-2xl bg-brand-900/30 flex flex-col items-center justify-center cursor-pointer hover:bg-brand-900/50 hover:border-brand-500 transition-all active:scale-95 duration-200">
                        <div class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mb-4">
                            <i class="fa-solid fa-cloud-arrow-up text-2xl text-brand-400"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white">Tap to Upload</h3>
                        <p class="text-sm text-gray-500 mt-1">PDF or Images</p>
                    </div>
                    <input type="file" id="file-input" class="hidden" accept=".pdf,.jpg,.jpeg,.png">
                </div>

                <div id="preview-state" class="hidden w-full flex flex-col items-center relative">
                    <div id="paper-mockup" class="relative bg-white shadow-2xl transition-all duration-300 mx-auto" style="width: 280px; height: 362px;">
                        <canvas id="main-canvas" class="w-full h-full object-contain block"></canvas>
                        
                        <div id="ov-staple-tl" class="staple-mark hidden" style="top:10px; left:10px; transform:rotate(-45deg);"></div>
                        <div id="ov-staple-tr" class="staple-mark hidden" style="top:10px; right:10px; transform:rotate(45deg);"></div>
                        <div id="ov-punch" class="hidden absolute left-1 top-0 h-full flex flex-col justify-around py-8"><div class="punch-hole"></div><div class="punch-hole"></div><div class="punch-hole"></div></div>
                        <div id="ov-fold" class="fold-line hidden" style="left:50%;"></div>
                    </div>

                    <div class="mt-6 flex items-center gap-3 bg-brand-900 px-4 py-2 rounded-full border border-gray-800 shadow-lg z-10">
                        <span id="file-type-badge" class="text-[10px] font-bold bg-gray-800 px-2 py-1 rounded text-gray-300">PDF</span>
                        <span id="file-name" class="text-sm text-gray-300 truncate max-w-[150px]">doc.pdf</span>
                        <button onclick="resetApp()" class="w-6 h-6 rounded-full bg-gray-800 flex items-center justify-center text-gray-400 hover:text-red-400"><i class="fa-solid fa-xmark text-xs"></i></button>
                    </div>
                </div>
            </div>

            <div id="controls-section" class="w-full lg:w-[400px] bg-brand-900 rounded-t-3xl lg:rounded-none border-t lg:border-t-0 lg:border-l border-gray-800 flex flex-col lg:h-auto transition-transform duration-300 transform translate-y-0 relative z-20 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
                
                <div id="lock-overlay" class="absolute inset-0 z-30 bg-brand-900/80 backdrop-blur-sm flex flex-col items-center justify-center text-center p-6">
                    <i class="fa-solid fa-lock text-3xl text-gray-600 mb-2"></i>
                    <p class="text-gray-400 font-medium">Upload a file to<br>unlock print settings</p>
                </div>

                <div class="p-6 pb-24 lg:pb-6 space-y-6">
                    <div class="flex items-center justify-between">
                        <h2 class="font-bold text-lg text-white">Job Settings</h2>
                        <span class="text-xs text-brand-400 bg-brand-950 px-2 py-1 rounded">Kyocera Driver</span>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500 uppercase">Paper Size</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="setSize('letter')" id="btn-letter" class="sz-btn active h-12 bg-brand-800 border-2 border-brand-500 rounded-xl text-xs font-bold text-white transition-all">Letter</button>
                            <button onclick="setSize('legal')" id="btn-legal" class="sz-btn h-12 bg-brand-950 border border-gray-700 rounded-xl text-xs font-medium text-gray-400 transition-all">Legal</button>
                            <button onclick="setSize('tabloid')" id="btn-tabloid" class="sz-btn h-12 bg-brand-950 border border-gray-700 rounded-xl text-xs font-medium text-gray-400 transition-all">Tabloid</button>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500 uppercase">Finishing</label>
                        <select id="finish-opt" onchange="updateFinish()" class="w-full h-12 bg-brand-950 border border-gray-700 rounded-xl px-4 text-sm text-white focus:border-brand-500 outline-none appearance-none">
                            <option value="none">None (Collated)</option>
                            <option value="staple-tl">Staple (Top Left)</option>
                            <option value="staple-dual">Staple (Dual Left)</option>
                            <option value="punch">Hole Punch (3-Hole)</option>
                            <option value="booklet">Booklet (Fold & Stitch)</option>
                            <option value="tri-fold">Tri-Fold (Marketing)</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-gray-500 uppercase">Stock</label>
                            <select id="stock-opt" onchange="updatePrice()" class="w-full h-12 bg-brand-950 border border-gray-700 rounded-xl px-3 text-sm text-white focus:border-brand-500 outline-none">
                                <option value="plain">Plain</option>
                                <option value="glossy">Glossy</option>
                                <option value="card">Cardstock</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="text-xs font-bold text-gray-500 uppercase">Color</label>
                            <select id="color-opt" onchange="updatePrice()" class="w-full h-12 bg-brand-950 border border-gray-700 rounded-xl px-3 text-sm text-white focus:border-brand-500 outline-none">
                                <option value="bw">B & W</option>
                                <option value="color">Full Color</option>
                            </select>
                        </div>
                    </div>

                    <div class="flex items-center justify-between bg-brand-950 p-2 rounded-xl border border-gray-700">
                        <button onclick="adjQty(-1)" class="w-10 h-10 bg-brand-800 rounded-lg text-white hover:bg-brand-700 font-bold">-</button>
                        <div class="text-center">
                            <div class="text-[10px] text-gray-500 uppercase font-bold">Copies</div>
                            <div class="font-bold text-lg" id="qty-disp">1</div>
                        </div>
                        <button onclick="adjQty(1)" class="w-10 h-10 bg-brand-800 rounded-lg text-white hover:bg-brand-700 font-bold">+</button>
                    </div>
                </div>

                <div class="fixed lg:absolute bottom-[60px] lg:bottom-0 left-0 w-full p-4 bg-brand-900 border-t border-gray-800 z-50">
                    <button onclick="addToCart()" id="btn-add" class="w-full h-14 bg-white text-brand-950 font-bold text-lg rounded-xl shadow-lg flex items-center justify-between px-6 active:scale-95 transition-transform">
                        <span>Add to Order</span>
                        <span id="price-disp">$0.10</span>
                    </button>
                </div>
            </div>
        </div>

        <div id="view-history" class="hidden p-6 max-w-2xl mx-auto min-h-screen">
            <h2 class="text-2xl font-bold mb-6">Past Orders</h2>
            <div id="history-list" class="space-y-4"></div>
            <div id="empty-history" class="text-center text-gray-500 mt-10 hidden">No past orders found.</div>
        </div>

    </main>

    <nav class="lg:hidden fixed bottom-0 left-0 w-full h-[60px] bg-brand-950 border-t border-gray-800 flex items-center justify-around z-50 pb-safe">
        <button onclick="switchView('new')" id="tab-new" class="flex flex-col items-center justify-center w-full h-full text-brand-500">
            <i class="fa-solid fa-circle-plus text-xl mb-1"></i>
            <span class="text-[10px] font-bold">New Job</span>
        </button>
        <button onclick="switchView('history')" id="tab-hist" class="flex flex-col items-center justify-center w-full h-full text-gray-500">
            <i class="fa-solid fa-clock-rotate-left text-xl mb-1"></i>
            <span class="text-[10px] font-bold">History</span>
        </button>
    </nav>

    <div id="cart-drawer" class="fixed inset-0 z-[70] bg-black/50 backdrop-blur-sm hidden transition-opacity">
        <div id="cart-panel" class="absolute right-0 top-0 h-full w-full sm:w-[400px] bg-brand-900 shadow-2xl transform translate-x-full transition-transform duration-300 flex flex-col">
            <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-brand-950">
                <h2 class="font-bold text-lg">Your Cart</h2>
                <button onclick="toggleCart()" class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center"><i class="fa-solid fa-xmark text-gray-400"></i></button>
            </div>
            
            <div class="p-4 bg-brand-800 border-b border-gray-700">
                 <input type="text" id="po-ref" placeholder="PO / Reference #" class="w-full bg-brand-900 border border-gray-700 rounded-lg p-3 text-sm text-white outline-none focus:border-brand-500">
            </div>

            <div id="cart-items" class="flex-1 overflow-y-auto p-4 space-y-3"></div>

            <div class="p-4 border-t border-gray-800 bg-brand-950 mb-safe">
                <div class="flex justify-between mb-4">
                    <span class="text-gray-400">Total</span>
                    <span class="font-bold text-xl text-white" id="cart-total">$0.00</span>
                </div>
                <button onclick="submitOrder()" id="btn-checkout" class="w-full h-14 bg-brand-600 font-bold rounded-xl text-white shadow-lg active:scale-95 transition-transform disabled:opacity-50 disabled:cursor-not-allowed">
                    Submit Order
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- LOGIC ---
        const PRICES = {
            letter: { bw: 0.10, color: 0.35 },
            legal: { bw: 0.15, color: 0.45 },
            tabloid: { bw: 0.25, color: 0.75 },
            stock: { plain: 0, glossy: 0.20, card: 0.15 },
            finish: { none: 0, 'staple-tl': 0.02, 'staple-dual': 0.03, punch: 0.01, booklet: 0.30, 'tri-fold': 0.10 }
        };

        let state = {
            user: JSON.parse(localStorage.getItem('mp_user')) || null,
            job: { file: null, type: 'pdf', pages: 1, size: 'letter', stock: 'plain', color: 'bw', finish: 'none', copies: 1 },
            cart: [],
            history: JSON.parse(localStorage.getItem('mp_history')) || []
        };

        // --- INIT ---
        if(state.user) {
            document.getElementById('login-modal').classList.add('hidden');
            document.getElementById('user-badge').innerText = state.user.name;
        }

        function login() {
            const name = document.getElementById('login-name').value;
            if(!name) return;
            state.user = { name, date: new Date().toLocaleDateString() };
            localStorage.setItem('mp_user', JSON.stringify(state.user));
            document.getElementById('user-badge').innerText = name;
            document.getElementById('login-modal').classList.add('opacity-0', 'pointer-events-none');
            setTimeout(() => document.getElementById('login-modal').classList.add('hidden'), 300);
        }

        // --- UPLOAD & VISUALIZER ---
        const fileInput = document.getElementById('file-input');
        fileInput.addEventListener('change', (e) => {
            if(e.target.files[0]) loadFile(e.target.files[0]);
        });

        async function loadFile(file) {
            state.job.file = file;
            state.job.type = file.type.includes('pdf') ? 'pdf' : 'img';
            
            // Unlock UI
            document.getElementById('upload-state').classList.add('hidden');
            document.getElementById('preview-state').classList.remove('hidden');
            document.getElementById('lock-overlay').classList.add('hidden');
            document.getElementById('file-name').innerText = file.name;
            document.getElementById('file-type-badge').innerText = state.job.type.toUpperCase();

            await renderCanvas();
            updatePrice();
        }

        async function renderCanvas() {
            const canvas = document.getElementById('main-canvas');
            const ctx = canvas.getContext('2d');
            const parent = document.getElementById('paper-mockup');
            
            // Set Aspect Ratio based on Paper Size
            const dims = { letter: [280, 362], legal: [280, 431], tabloid: [362, 559] }; // Scaled for mobile view
            const [w, h] = dims[state.job.size];
            parent.style.width = w + 'px';
            parent.style.height = h + 'px';
            
            canvas.width = w * 2; // Retina scale
            canvas.height = h * 2;
            ctx.clearRect(0,0, canvas.width, canvas.height);

            if(state.job.type === 'pdf') {
                const buff = await state.job.file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(buff).promise;
                state.job.pages = pdf.numPages;
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: canvas.width / page.getViewport({scale:1}).width });
                await page.render({ canvasContext: ctx, viewport: viewport }).promise;
            } else {
                state.job.pages = 1;
                const img = new Image();
                img.onload = () => {
                     // Center Fit
                    const scale = Math.min(canvas.width/img.width, canvas.height/img.height);
                    const x = (canvas.width/2) - (img.width/2)*scale;
                    const y = (canvas.height/2) - (img.height/2)*scale;
                    ctx.drawImage(img, x, y, img.width*scale, img.height*scale);
                };
                img.src = URL.createObjectURL(state.job.file);
            }
        }

        // --- CONTROLS ---
        function setSize(sz) {
            state.job.size = sz;
            document.querySelectorAll('.sz-btn').forEach(b => {
                b.classList.remove('active', 'border-brand-500', 'bg-brand-800', 'text-white');
                b.classList.add('bg-brand-950', 'border-gray-700', 'text-gray-400');
            });
            const btn = document.getElementById('btn-'+sz);
            btn.classList.add('active', 'border-brand-500', 'bg-brand-800', 'text-white');
            btn.classList.remove('bg-brand-950', 'border-gray-700', 'text-gray-400');
            renderCanvas();
            updatePrice();
        }

        function updateFinish() {
            state.job.finish = document.getElementById('finish-opt').value;
            // Visual Overlays
            document.querySelectorAll('.staple-mark, .punch-hole, .fold-line, #ov-punch').forEach(e => e.classList.add('hidden'));
            
            const f = state.job.finish;
            if(f === 'staple-tl') document.getElementById('ov-staple-tl').classList.remove('hidden');
            if(f === 'staple-dual') {
                const el = document.getElementById('ov-staple-tl');
                el.classList.remove('hidden');
                el.style.transform = 'rotate(90deg)'; el.style.top = '50%';
            }
            if(f === 'punch') document.getElementById('ov-punch').classList.remove('hidden');
            if(f === 'booklet' || f === 'tri-fold') document.getElementById('ov-fold').classList.remove('hidden');
            updatePrice();
        }

        function adjQty(delta) {
            let n = state.job.copies + delta;
            if(n < 1) n = 1;
            state.job.copies = n;
            document.getElementById('qty-disp').innerText = n;
            updatePrice();
        }

        function updatePrice() {
            state.job.stock = document.getElementById('stock-opt').value;
            state.job.color = document.getElementById('color-opt').value;
            
            const base = PRICES[state.job.size][state.job.color];
            const xtra = PRICES.stock[state.job.stock] + PRICES.finish[state.job.finish];
            const unit = base + xtra;
            const total = unit * state.job.pages * state.job.copies;
            
            state.job.cost = total;
            document.getElementById('price-disp').innerText = '$' + total.toFixed(2);
        }

        function resetApp() {
            state.job.file = null;
            document.getElementById('preview-state').classList.add('hidden');
            document.getElementById('upload-state').classList.remove('hidden');
            document.getElementById('lock-overlay').classList.remove('hidden');
            document.getElementById('file-input').value = '';
        }

        // --- CART & ORDER ---
        function addToCart() {
            if(!state.job.file) return;
            state.cart.push({...state.job, id: Date.now()});
            updateCart();
            resetApp();
            // Show Cart
            const drawer = document.getElementById('cart-drawer');
            drawer.classList.remove('hidden');
            setTimeout(() => document.getElementById('cart-panel').classList.remove('translate-x-full'), 10);
        }

        function updateCart() {
            const list = document.getElementById('cart-items');
            const badge = document.getElementById('cart-badge');
            
            badge.innerText = state.cart.length;
            badge.classList.toggle('hidden', state.cart.length === 0);
            
            let total = 0;
            let html = '';
            
            state.cart.forEach((item, i) => {
                total += item.cost;
                html += `
                <div class="bg-brand-950 p-3 rounded-xl border border-gray-800 flex gap-3 relative">
                    <button onclick="remItem(${i})" class="absolute top-2 right-2 text-gray-500 hover:text-red-500"><i class="fa-solid fa-xmark"></i></button>
                    <div class="w-10 h-10 bg-gray-800 rounded flex items-center justify-center">
                        <i class="fa-solid ${item.type === 'pdf' ? 'fa-file-pdf text-red-400' : 'fa-image text-blue-400'}"></i>
                    </div>
                    <div>
                        <p class="font-bold text-sm text-white truncate w-40">${item.file.name}</p>
                        <p class="text-[10px] text-gray-400 uppercase">${item.size} • ${item.color} • ${item.finish}</p>
                        <p class="text-xs font-bold text-brand-400 mt-1">$${item.cost.toFixed(2)}</p>
                    </div>
                </div>`;
            });
            
            list.innerHTML = html || '<div class="text-center text-gray-500 mt-10">Cart is empty</div>';
            document.getElementById('cart-total').innerText = '$' + total.toFixed(2);
            document.getElementById('btn-checkout').disabled = state.cart.length === 0;
        }

        function remItem(i) {
            state.cart.splice(i, 1);
            updateCart();
        }

        function toggleCart() {
            const drawer = document.getElementById('cart-drawer');
            const panel = document.getElementById('cart-panel');
            
            if(drawer.classList.contains('hidden')) {
                drawer.classList.remove('hidden');
                setTimeout(() => panel.classList.remove('translate-x-full'), 10);
            } else {
                panel.classList.add('translate-x-full');
                setTimeout(() => drawer.classList.add('hidden'), 300);
            }
        }

        function submitOrder() {
            const po = document.getElementById('po-ref').value || 'None';
            Swal.fire({
                title: 'Confirm Order?',
                text: `Reference: ${po}`,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#2563eb',
                confirmButtonText: 'Send to Print',
                background: '#111827', color: '#fff'
            }).then((res) => {
                if(res.isConfirmed) {
                    const order = {
                        id: 'JOB-' + Math.floor(Math.random()*9000),
                        date: new Date().toLocaleDateString(),
                        items: state.cart.length,
                        total: document.getElementById('cart-total').innerText,
                        po: po
                    };
                    state.history.unshift(order);
                    localStorage.setItem('mp_history', JSON.stringify(state.history));
                    state.cart = [];
                    updateCart();
                    toggleCart();
                    switchView('history');
                    Swal.fire({title:'Sent!', icon:'success', background: '#111827', color: '#fff', timer: 1500, showConfirmButton: false});
                }
            });
        }

        // --- VIEWS ---
        function switchView(v) {
            const viewNew = document.getElementById('view-new');
            const viewHist = document.getElementById('view-history');
            const tabNew = document.getElementById('tab-new');
            const tabHist = document.getElementById('tab-hist');
            
            if(v === 'new') {
                viewNew.classList.remove('hidden');
                viewHist.classList.add('hidden');
                tabNew.classList.replace('text-gray-500', 'text-brand-500');
                tabHist.classList.replace('text-brand-500', 'text-gray-500');
            } else {
                viewNew.classList.add('hidden');
                viewHist.classList.remove('hidden');
                tabHist.classList.replace('text-gray-500', 'text-brand-500');
                tabNew.classList.replace('text-brand-500', 'text-gray-500');
                renderHistory();
            }
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            if(!state.history.length) {
                document.getElementById('empty-history').classList.remove('hidden');
                return;
            }
            document.getElementById('empty-history').classList.add('hidden');
            
            list.innerHTML = state.history.map(o => `
                <div class="bg-brand-900 border border-gray-800 p-4 rounded-xl flex justify-between items-center">
                    <div>
                        <div class="font-bold text-white text-lg">${o.id}</div>
                        <div class="text-xs text-gray-500">${o.date} • PO: ${o.po}</div>
                        <div class="text-xs text-gray-400 mt-1">${o.items} Items</div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-brand-400 text-lg">${o.total}</div>
                        <div class="text-[10px] bg-green-900/30 text-green-400 px-2 py-0.5 rounded border border-green-900/50 inline-block mt-1">SENT</div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
